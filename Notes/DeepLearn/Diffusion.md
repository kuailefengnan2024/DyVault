
---

### 2. 扩散模型 (Diffusion Model) 流程
**任务**: 生成一张 4x4 的灰度图像（简化示例）。  
**示例输入**: 一个随机的噪声图像，目标是生成一个简单的 “X” 形状图像。  
**目标图像（假设）**:  
```
tensor([
  [1, 0, 0, 1],
  [0, 1, 1, 0],
  [0, 1, 1, 0],
  [1, 0, 0, 1]
])（1 表示白色，0 表示黑色）
```

---

#### 2.1 前向扩散 (Forward Diffusion)
**操作**: 从目标图像开始，逐步添加高斯噪声 T 次（假设 T=3）。  
- 输入维度: [4, 4]（初始图像）。  
- 输出维度: [4, 4]（噪声图像）。  
```
  输入: tensor([
    [1, 0, 0, 1],
    [0, 1, 1, 0],
    [0, 1, 1, 0],
    [1, 0, 0, 1]
  ])
  第 1 次加噪: tensor([
    [0.9, 0.1, 0.1, 0.9],
    [0.1, 0.8, 0.9, 0.1],
    [0.1, 0.9, 0.8, 0.1],
    [0.9, 0.1, 0.1, 0.9]
  ])（轻微噪声）
  第 3 次加噪: tensor([
    [0.5, 0.4, 0.6, 0.5],
    [0.3, 0.6, 0.5, 0.4],
    [0.4, 0.5, 0.6, 0.3],
    [0.5, 0.4, 0.5, 0.6]
  ])（接近纯噪声）
```

---

#### 2.2 初始采样 (Sample Initial Noise)
**操作**: 从纯噪声开始逆向生成，假设初始采样为高斯噪声。  
- 输入维度: 无（随机生成）。  
- 输出维度: [4, 4]。  
```
  输入: 无
  输出: tensor([
    [0.6, 0.5, 0.4, 0.6],
    [0.3, 0.7, 0.5, 0.4],
    [0.5, 0.6, 0.4, 0.3],
    [0.4, 0.5, 0.6, 0.5]
  ])（随机噪声，形状: [4, 4]）
```

---

#### 2.3 逆向扩散 - 卷积层 (Reverse Diffusion - Convolution)
**操作**: 使用 U-Net 结构预测噪声，假设使用 3x3 卷积核，通道数从 1 增至 16。  
- 输入维度: [1, 4, 4]（单通道图像）。  
- 输出维度: [16, 2, 2]（卷积后缩小）。  
```
  输入: tensor([
    [[0.6, 0.5, 0.4, 0.6],
     [0.3, 0.7, 0.5, 0.4],
     [0.5, 0.6, 0.4, 0.3],
     [0.4, 0.5, 0.6, 0.5]]
  ])
  输出: tensor([
    [[0.5, 0.4], [0.6, 0.5]],
    ...,
    [[0.3, 0.4], [0.5, 0.6]]
  ])（16 个 2x2 特征图，假设卷积结果）
```

---

#### 2.4 逆向扩散 - 上采样 (Upsampling)
**操作**: 将特征图上采样回 4x4，通道数减至 1。  
- 输入维度: [16, 2, 2]。  
- 输出维度: [1, 4, 4]（预测的去噪图像）。  
```
  输入: tensor([...])（16 个 2x2 特征图）
  输出: tensor([
    [0.7, 0.2, 0.3, 0.6],
    [0.2, 0.6, 0.5, 0.3],
    [0.3, 0.5, 0.6, 0.2],
    [0.6, 0.3, 0.4, 0.7]
  ])（初步去噪图像）
```

---

#### 2.5 迭代去噪 (Iterative Denoising)
**操作**: 重复逆向扩散 T 次（假设 T=3），逐步还原图像。  
- 输入维度: [1, 4, 4]。  
- 输出维度: [1, 4, 4]。  
```
  输入: tensor([
    [0.7, 0.2, 0.3, 0.6],
    [0.2, 0.6, 0.5, 0.3],
    [0.3, 0.5, 0.6, 0.2],
    [0.6, 0.3, 0.4, 0.7]
  ])
  第 3 次去噪: tensor([
    [1.0, 0.0, 0.0, 1.0],
    [0.0, 1.0, 1.0, 0.0],
    [0.0, 1.0, 1.0, 0.0],
    [1.0, 0.0, 0.0, 1.0]
  ])（还原为目标 “X” 形状图像）
```

---

### 总结
- **自回归模型**: 通过逐步预测下一个词生成序列，适用于文本生成，依赖因果关系。
- **扩散模型**: 从噪声开始，通过迭代去噪生成图像，适用于生成高质量连续数据。

这两个流程展示了两种生成模型的核心思想，具体实现中可能涉及更多超参数和优化步骤，但这里已简化为清晰的示例。